[toc]

## 网络层

![image-20200209234019009](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20200209234019009.png)



![image-20200209233700299](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20200209233700299.png)



#### 网络层提供的服务

两种服务：

- 向运输层提供"面向连接"虚电路
- "无连接"数据报服务

区别：

- 前者预约了双方通信所需要的的一切网络资源，优点：能提供服务质量的承诺，即：所传输的分组不出错，丢失，重复和失序，也保证分组传送的时限，缺点：路由器复杂，网络成本高
- 后者无网络资源障碍，尽力而为，有钱与前者互异

**无连接数据报服务**

向上只提供简单灵活的，无连接的，尽最大努力交付的数据报任务

- 网络在发送分组的时候，不需要建立连接，每一个分组独立无序发送
- 网络层不提供服务质量的承诺。即所传送的分组可能会出错，丢失，重复和失序(不按照顺序到达终点)，也不保证分组传送的时限

![image-20200209234120560](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20200209234120560.png)



尽最大努力的好处

- 网络的造价大大降低，运行方式灵活，能够适应多种应用
-  如果主机（即端系统）中的进程之间的通信需要是可靠的，那么就由网络的主机中的运输层负责（包括差错处理、流量控制等） 

![image-20200209235412748](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20200209235412748.png)

##### 2，虚电路

- 虚电路表示这只是一条逻辑上的连接，分组都沿着这条逻辑连接按照存储转发方式传送，而并不是真正建立了一条物理连接。
- 请注意，电路交换的电话通信是先建立了一条真正的连接。因此分组交换的虚连接和电路交换的连接只是类似，但并不完全一样。

![image-20200210000616778](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20200210000616778.png)





###### 虚电路与数据报服务对比：

 ![img](https://user-gold-cdn.xitu.io/2019/12/21/16f265172c3adc1c?imageView2/0/w/1280/h/960/format/webp/ignore-error/1) 



#### 网络层传输数据与ISO七层参考模型之间的联系

**准备发送方：**

- **应用层**：应用程序准备需要传输的数据
- **传输层(段)**：将文件分段，编号
- **网络层（包）**：加上原IP地址与目标IP地址
- **数据链路层（帧）**：
  - 通信的计算机与自身为一个网段:使用自己的子网掩码判断自己所在的网段，以及目标地址的网段所在，**如果在同一个网段，直接使用ARP协议广播解析目标IP地址的MAC**
  - **跨网段通信则必须加上目标MAC与原MAC地址以及帧校验序列FCS**

- **物理层(比特流)**：变成二进制比特流



###### 发送数据的过程：

**物理层**：集线器：信号加强，传输比特流。不做任何判断，只负责传递信号

交换机此时接受集线器传输的比特流，**存储到交换机的接口(存储转发)**，然后选择出口，通过查看目标MAC，决定有那个出口发送出去。（交换机能够看懂数据链路层的地址并根据此进行数据转发，所以**交换机为二层设备**，可以看懂物理层的比特流）然后根据**路由器**收到数据帧之后就会将数据链路层中添加的数据逐一去除：目标MAC，原MAC以及帧校验序列(FCS)去除，并根据数据包的目标地址选择出口，但是路由器无法识别数据包的内容。

路由器之间如果使用的是**PPP协议**就会添加目标MAC，然后跳到目标地址之后再由路由器进行数据拆封，然后依次装箱。



![image-20200210005100266](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20200210005100266.png)

**路由器(三层设备)**：数据包的流动

**交换机(二层设备)**：帧的流动

**集线器(网络设备)**：比特流的流动

注意：路由器也可以往下认识帧等

**路由器能否中病毒：**

无法，病毒以应用程序的形式展开，但是代码在传输的过程中是以数据段的形式进行传输，在路由器中以代码段的形式展开

但是病毒可以影响到路由器等，是的网络设备占用主要的资源进行无用的数据传递

#### 网络层的协议

![image-20200210005852225](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20200210005852225.png)

##### ARP协议：地址解析协议

**作用：**用于实现从IP地址到MAC地址的映射，即询问目标IP对应的MAC地址

在网络通信中，主机和主机通信的数据包需要依据OSI模型从上到下进行数据封装完整后，再向外发出。所以在局域网的通信中，不仅需要原目标IP地址，也需要原目标MAC地址

一般情况下，上层医用程序更多关心IP地址而不关心MAC地址，所以需要ARP协议来获取目标主机的MAC地址，完成数据封装



**注意：**

- 只能解析同一网段下的MAC地址，通过广播的方式，不可以跨路由
- 扫描本网段的MAC地址：arp -a

广播：

根据所在的层次分为二层广播和三层郭昂博，根据发生范围可以分为定向广播和本地广播

###### ARP欺骗：MAC地址欺骗

##### ICMP网际控制报文协议：

**作用**：在IP协议之上，用来测试网络层是否存在故障，并且可以报告故障等

原理：利用网络上机器IP地址的唯一性，给目标地址发送一个数据包，在要求对方返回一个同样大小的数据包来确定两台网络及其是否连接相同，时延是多少





![image-20200210153131277](C:\Users\Lenovo\Desktop\计算机网络\image-20200210153131277.png)



常用命令：PING

```cpp
ping + ip地址/域名         //发四次ICMP包，如 ping www.baidu.com
ping + ip地址/域名 + -t    // 一直发ICMP包，直到 ctrl+c停止，用来不断检验网络是否通畅，如 ping www.baidu.com -t
ping /?                   // 查看ping的参数说明
```

**TTL**是 Time To Live的缩写，该字段指定IP包被路由器丢弃之前允许通过的最大网段数量。TTL是IPv4包头的一个8 bit字段。TTL每过一次路由器减一，减到零后数据包丢失。不同操作系统的默认初始TTL不同，Linux 64，Windows 128，Unix 255

TTL:**数据包的生存时间**；数据包每路过一个路由器TTL就会减一，当TTL=0时，数据包就会消失，防止数据包在网络中陷入循环

**pathping**

**pathping**是指提供有关在源和目标之间的中间跃点处网络滞后和网络丢失的信息。



```ruby
C:\Users\Yukim>pathping www.baidu.com

通过最多 30 个跃点跟踪
到 www.a.shifen.com [220.181.111.188] 的路由:
  0  DESKTOP-0V38VPE [10.170.53.153]
  1  10.170.72.254
  2  172.16.255.242
  3  172.16.255.254
  4  113.140.11.97
  5  10.224.13.9
  6  117.36.240.109
  7     *     202.97.65.113
  8     *        *        *
正在计算统计信息，已耗时 175 秒...
            指向此处的源   此节点/链接
跃点  RTT    已丢失/已发送 = Pct  已丢失/已发送 = Pct  地址
  0                                           DESKTOP-0V38VPE [10.170.53.153]
                                0/ 100 =  0%   |
  1    0ms     0/ 100 =  0%     0/ 100 =  0%  10.170.72.254
                                0/ 100 =  0%   |
  2   19ms     0/ 100 =  0%     0/ 100 =  0%  172.16.255.242
                                0/ 100 =  0%   |
  3    0ms     0/ 100 =  0%     0/ 100 =  0%  172.16.255.254
                                0/ 100 =  0%   |
  4    0ms     0/ 100 =  0%     0/ 100 =  0%  113.140.11.97
                                0/ 100 =  0%   |
  5    1ms     0/ 100 =  0%     0/ 100 =  0%  10.224.13.9
                                0/ 100 =  0%   |
  6    3ms     0/ 100 =  0%     0/ 100 =  0%  117.36.240.109
                              100/ 100 =100%   |
  7  ---     100/ 100 =100%     0/ 100 =  0%  202.97.65.113

跟踪完成。
```

**Tracert:**

 （跟踪路由）是路由跟踪实用程序，用于确定 IP数据包访问目标所采取的路径。Tracert 命令使用用 IP 生存时间 (TTL) 字段和 ICMP 错误消息来确定从一个主机到网络上其他主机的路由。 



##### IGMP:因特网组播管理协议

Internet Group Management Protocol；可跨网段传播，比较节省流量。 

- **单播(unicast):** 是指封包在计算机网络的传输中，**目的地址为单一目标**的一种传输方式。它是现今网络应用最为广泛，通常所使用的网络协议或服务大多采用单播传输，例如一切基于TCP的协议。
- **组播(multicast):** 也叫**多播**， 多点广播或群播。 指把信息同时传递给一组目的地址。它使用策略是最高效的，因为消息在每网络链路上**只需传递一次**，而且只有在链路分叉的时候，消息才会被复制。
-  **广播(broadcast):**是指封包在计算机网络中传输时，目的地址为网络中所有设备的一种传输方式。实际上，这里所说的“所有设备”也是限定在一个范围之中，称为“广播域”。

#### IP数据包结构：

数据在网络层添加了那些信息

![image-20200210161646332](C:\Users\Lenovo\Desktop\计算机网络\image-20200210161646332.png)



![image-20200210191623116](C:\Users\Lenovo\Desktop\计算机网络\image-20200210191623116.png)

#### 网络设备

#### IP协议

##### RIP协议

##### OSPF

#### ARP协议





